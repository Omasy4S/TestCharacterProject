using System;
using TestCharacterProject.Models;

namespace TestCharacterProject.Weapons
{
    /// <summary>
    /// Жезл Дурака - хаотичное магическое оружие с непредсказуемым эффектом.
    /// 
    /// ОСОБЕННОСТИ:
    /// 1. Меняет местами Силу и Магию у магов (побочный эффект!)
    /// 2. Наносит случайный урон от 0 до 10
    /// 3. При повторном использовании характеристики мага меняются обратно
    /// 
    /// ПОЧЕМУ ТАК РЕАЛИЗОВАНО:
    /// - Random создается один раз как статическое поле класса, а не в методе.
    ///   Это важно: new Random() в методе даст одинаковые значения при быстрых вызовах,
    ///   потому что Random инициализируется на основе времени (с точностью до миллисекунд).
    /// - Статический Random решает эту проблему и работает корректно.
    /// </summary>
    public class FoolStaff : IWeapon
    {
        public string Name => "Жезл Дурака";

        // Статический Random для корректной генерации случайных чисел.
        // Создается один раз при первом обращении к классу и переиспользуется.
        // Это предотвращает проблему с одинаковыми значениями при быстрых вызовах.
        private static readonly Random _random = new Random();

        /// <summary>
        /// Рассчитывает урон жезла дурака с побочным эффектом.
        /// 
        /// АЛГОРИТМ:
        /// 1. Если атакующий - маг, меняем его Силу и Магию местами
        /// 2. Генерируем случайный урон от 0 до 10 (включительно)
        /// 3. Возвращаем урон
        /// 
        /// ВАЖНО: Изменение характеристик постоянно!
        /// При первой атаке маг (Сила=1, Магия=2) станет (Сила=2, Магия=1).
        /// При второй атаке он вернется к (Сила=1, Магия=2).
        /// Это создает интересную игровую механику с риском.
        /// </summary>
        public int CalculateDamage(Character attacker)
        {
            // Проверяем тип атакующего с помощью pattern matching (is)
            if (attacker is Mage)
            {
                // Классический swap через временную переменную
                // Меняем характеристики мага местами
                int temp = attacker.Strength;
                attacker.Strength = attacker.Magic;
                attacker.Magic = temp;

                // Альтернативный способ (C# 7.0+): (attacker.Strength, attacker.Magic) = (attacker.Magic, attacker.Strength);
                // Но явный swap через temp более понятен для чтения кода
            }

            // Генерируем случайный урон от 0 до 10 включительно
            // Random.Next(0, 11) возвращает значение в диапазоне [0, 11), т.е. от 0 до 10
            int damage = _random.Next(0, 11);

            return damage;
        }
    }
}
